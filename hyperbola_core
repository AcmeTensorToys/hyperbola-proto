The Hyperbola Protocol is a simple addressed TLV stream,
modeled loosely on MIDI and the OpenAMD protocol set.

The packet framing is composed of the following one-byte fields,
which prefix data.
	The constant byte 0x55.
	A destination identifier/broadcast (sim. MIDI channel)
	A source identifier
	A packet length (of the data inside the frame)
	A command byte

On byte-wise transports, we suggest imposing a timeout rule of the form "if
the line idles for more than N byte times while framing, reset the state
machine."  On packetizing unreliable transports, we suggest not having
Hyperbola packets straddle link-layer packets.

There is a region of common commands understood by all Hyperbola
devices (values 0x00 to 0x0F) and a region which is target device
specific.

The destination identifier 0xFF is reserved for broadcast and should only be
used to carry payloads with common commands.  Hyberbola devices have a 4
byte device type ID and a 4 byte serial number (unique only within device
types).  Device ID 0 is reserved for "all devices"; serial number 0 is
reserved to indicate "all units" of a given device type.  Broadcast packets
may not contain device-specific command bytes, so the range 0x10 to 0xFF
is again defined by this document.

Common commands:
	0x00	IDENTIFY THYSELF

		The payload begins with a four-byte opaque value, which is
		echoed in responses.

		The payload continues with a mode-dependent header:
			Broadcast carrier, specific device:
				device type ID, serial number
			Broadcast carrier, all devices of a given type:
				device type ID, 0x00000000
			Broadcast carrier, all devices of all types:
				0x00000000, 0x00000000
			Unicast carrier:
				may be omitted (ignored if present)

		Sends a (unicast) response to the source containing:
			the opaque value,
			this node's device type
			serial number
			additional device-type specific data
		
		The "source indicator" for this response shall be the broadcast
		address if the device does not have an address configured.

	0x01	SET ADDRESS
		As a broadcast payload, expects a payload containing:
			The device type ID
			The device serial number
			The new device address
		In unicast payload, expects only the new device address.

		Responds from the new device address with an identical payload.

	0x02	SET UNDERLYING COMMUNICATIONS PARAMETERS
		Establishes parameters for the underlying communication (e.g. radio
		parameters as appropriate).  Commands begin with a single byte
		payload:
			0x00 CANCEL
			0x01 ENQUEUE
			0xFF APPLY
		
		Note that the contents of this payload after the initial header are
		device specific.

		This command is only accepted as a unicast payload.

		As it may take many commands to set all the parameters of a device,
		changes should be buffered until a finalize subcommand is sent.  All
		responses, including to the command which applies the changes, are
		sent using the old parameters.

		Responses contain a single byte, paralleling the header, with 0x00
		being interpreted as "unable to comply", 0x01 indicating a
		successful parse, and 0xFF indicating that changes have been
		applied.

		It is RECOMMENDED that Hyperbola devices have a fixed-function
		format fallback mechanism for configuration in addition to their
		primary interface.  It is highly suggested that this be 3-wire
		TTL UART at 9600 8n1, speaking Hyperbola.

Broadcast-only notices

	Unlike commands, these packets do not elicit responses to the
	originating node.

	0x10	BEACON
		Devices may optionally signal, via BEACONs, that they are on.
		This may also be useful as a primitive form of BOOTP for address
		assignment.

		The payload here is an IDENTIFY THYSELF response with a monotonic
		increasing (with wraparound) opaque value.

	0x20	SINGLE EVENT REPORT
		While Hyperbola devices may have pub/sub style handling of events,
		occasionally it is useful to have event notices hit the entire
		network.  This is intended for rare event notification from devices
		on the network, and may be used even by devices that do not have
		addresses.

		The payload here is up to 13 bytes:
			device type ID
			device serial number
			device-specific event ID (1 byte)
			event value (0 to 4 bytes)

